# Claude.md

## êµ­ì œí™”(i18n) ê°€ì´ë“œë¼ì¸

### ì¤‘ìš”: ëª¨ë“  UI í…ìŠ¤íŠ¸ëŠ” í•œê¸€/ì˜ì–´ ìŒìœ¼ë¡œ ì‘ì—…í•˜ì„¸ìš”

ì•±ì€ í•œêµ­ì–´ì™€ ì˜ì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. **ì ˆëŒ€ í•˜ë“œì½”ë”©ëœ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.**
app_localizations.dart ì°¸ê³ 

#### 1. ìƒˆë¡œìš´ UI í…ìŠ¤íŠ¸ ì¶”ê°€ ì‹œ

1. **AppLocalizationsì— ì¶”ê°€** (`lib/l10n/app_localizations.dart`):
```dart
// ì˜ˆì‹œ: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
String get newFeature => isKorean ? 'ìƒˆ ê¸°ëŠ¥' : 'New Feature';
String get featureDescription => isKorean ? 'ì´ê²ƒì€ ìƒˆë¡œìš´ ê¸°ëŠ¥ì…ë‹ˆë‹¤' : 'This is a new feature';
```

2. **í™”ë©´ì—ì„œ ì‚¬ìš©**:
```dart
// âŒ ì˜ëª»ëœ ì˜ˆì‹œ - í•˜ë“œì½”ë”©
Text('ìƒˆ ê¸°ëŠ¥')

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ - AppLocalizations ì‚¬ìš©
Text(AppLocalizations.of(context)!.newFeature)
```

#### 2. ì¹´í…Œê³ ë¦¬ë³„ ë²ˆì—­ êµ¬ì¡°

AppLocalizationsì˜ ë²ˆì—­ì€ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
- ê³µí†µ (loading, error, confirm ë“±)
- ë¡œê·¸ì¸/íšŒì›ê°€ì…
- ê°ì •/í˜ë¥´ì†Œë‚˜
- ì±„íŒ…
- ìŠ¤í† ì–´/êµ¬ë§¤
- ì„¤ì •
- ì—ëŸ¬ ë©”ì‹œì§€
- ê¶Œí•œ
- ë‚ ì§œ/ì‹œê°„

ìƒˆë¡œìš´ ë²ˆì—­ ì¶”ê°€ ì‹œ ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ì— ì¶”ê°€í•˜ì„¸ìš”.

#### 3. ë™ì  í…ìŠ¤íŠ¸ ì²˜ë¦¬

íŒŒë¼ë¯¸í„°ê°€ í•„ìš”í•œ ê²½ìš°:
```dart
// AppLocalizationsì— ì¶”ê°€
String welcomeUser(String name) => isKorean ? '$nameë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!' : 'Welcome, $name!';
String itemCount(int count) => isKorean ? 'ì•„ì´í…œ $countê°œ' : '$count items';

// ì‚¬ìš©
Text(localizations.welcomeUser(userName))
```

#### 4. ëª¨ë“  í™”ë©´ì—ì„œ í•„ìˆ˜ import

```dart
import '../l10n/app_localizations.dart';

// build ë©”ì„œë“œ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€
@override
Widget build(BuildContext context) {
  final localizations = AppLocalizations.of(context)!;
  // ...
}
```

#### 5. ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆë¡œìš´ í™”ë©´ì´ë‚˜ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ:
- [ ] ëª¨ë“  í…ìŠ¤íŠ¸ê°€ AppLocalizationsë¥¼ í†µí•´ í‘œì‹œë˜ëŠ”ê°€?
- [ ] í•œê¸€ê³¼ ì˜ì–´ ë²ˆì—­ì´ ëª¨ë‘ ì¶”ê°€ë˜ì—ˆëŠ”ê°€?
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ë„ ë²ˆì—­ë˜ì—ˆëŠ”ê°€?
- [ ] ë‹¤ì´ì–¼ë¡œê·¸ í…ìŠ¤íŠ¸ë„ ë²ˆì—­ë˜ì—ˆëŠ”ê°€?
- [ ] ìŠ¤ë‚µë°” ë©”ì‹œì§€ë„ ë²ˆì—­ë˜ì—ˆëŠ”ê°€?

---

## ë¦¬íŒ©í† ë§ëœ ì•„í‚¤í…ì²˜ êµ¬ì¡°

### 1. BaseService íŒ¨í„´
ëª¨ë“  ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ëŠ” `BaseService`ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•©ë‹ˆë‹¤.

```dart
// lib/services/base/base_service.dart
abstract class BaseService extends ChangeNotifier {
  // ê³µí†µ ë¡œë”© ìƒíƒœ ë° ì—ëŸ¬ í•¸ë“¤ë§
  bool _isLoading = false;
  String? _error;
  
  // ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰ ë©”ì„œë“œ
  Future<T?> executeWithLoading<T>(Future<T> Function() action);
  Future<T?> executeSafely<T>(Future<T> Function() action);
  T? executeSafelySync<T>(T Function() action);
}
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```dart
class MyService extends BaseService {
  Future<void> fetchData() async {
    await executeWithLoading(() async {
      // ìë™ìœ¼ë¡œ ë¡œë”© ìƒíƒœ ê´€ë¦¬ ë° ì—ëŸ¬ í•¸ë“¤ë§
      final result = await api.getData();
      return result;
    });
  }
}
```

### 2. AppConstants ì¤‘ì•™ ê´€ë¦¬
ëª¨ë“  ìƒìˆ˜ê°’ì€ `AppConstants` í´ë˜ìŠ¤ì—ì„œ ì¤‘ì•™ ê´€ë¦¬í•©ë‹ˆë‹¤.

```dart
// lib/core/constants.dart
class AppConstants {
  // Firebase ì»¬ë ‰ì…˜ëª…
  static const String usersCollection = 'users';
  static const String personasCollection = 'personas';
  
  // í† í° ì œí•œ
  static const int maxInputTokens = 3000;
  static const int maxOutputTokens = 300;
  
  // ë¡œì»¬ ì €ì¥ì†Œ í‚¤
  static const String deviceIdKey = 'device_id';
  static const String tutorialModeKey = 'tutorial_mode';
}
```

**ì‚¬ìš© ê·œì¹™**:
- í•˜ë“œì½”ë”©ëœ ë¬¸ìì—´ ëŒ€ì‹  í•­ìƒ AppConstants ì‚¬ìš©
- ìƒˆë¡œìš´ ìƒìˆ˜ëŠ” ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì¶”ê°€
- ì˜ë¯¸ ìˆëŠ” ì´ë¦„ ì‚¬ìš© (ì˜ˆ: `maxInputTokens` not `MAX_TOKEN`)

### 3. FirebaseHelper íŒ¨í„´
Firebase ì‘ì—…ì€ `FirebaseHelper`ë¥¼ í†µí•´ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```dart
// lib/helpers/firebase_helper.dart
class FirebaseHelper {
  // ì»¬ë ‰ì…˜ ì°¸ì¡°
  static CollectionReference<Map<String, dynamic>> get users;
  static DocumentReference<Map<String, dynamic>> user(String userId);
  
  // ì„œë¸Œ ì»¬ë ‰ì…˜
  static CollectionReference<Map<String, dynamic>> userChats(String userId);
  
  // ê³µí†µ ì‘ì—…
  static Map<String, dynamic> withTimestamps(Map<String, dynamic> data);
  static WriteBatch batch();
}
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```dart
// ìœ ì € ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°
final userDoc = await FirebaseHelper.user(userId).get();

// íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€í•˜ì—¬ ì €ì¥
await FirebaseHelper.userChats(userId).add(
  FirebaseHelper.withTimestamps({
    'message': 'Hello',
    'personaId': personaId,
  })
);
```

### 4. PreferencesManager ì‹±ê¸€í†¤
ë¡œì»¬ ì €ì¥ì†ŒëŠ” `PreferencesManager`ë¥¼ í†µí•´ ê´€ë¦¬í•©ë‹ˆë‹¤.

```dart
// lib/core/preferences_manager.dart
class PreferencesManager {
  // ì´ˆê¸°í™” (ì•± ì‹œì‘ ì‹œ í˜¸ì¶œ)
  static Future<void> initialize();
  
  // íƒ€ì…ë³„ ì €ì¥/ë¡œë“œ ë©”ì„œë“œ
  static Future<bool> setString(String key, String value);
  static Future<String?> getString(String key);
  
  // ì•± ì „ìš© ë©”ì„œë“œ
  static Future<String?> getDeviceId();
  static Future<bool> setTutorialMode(bool value);
}
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```dart
// ì•± ì‹œì‘ ì‹œ ì´ˆê¸°í™”
await PreferencesManager.initialize();

// ë””ë°”ì´ìŠ¤ ID ì €ì¥
await PreferencesManager.setDeviceId(deviceId);

// íŠœí† ë¦¬ì–¼ ëª¨ë“œ í™•ì¸
final isTutorial = await PreferencesManager.isTutorialMode();
```

### 5. ë³´ì•ˆ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

#### SecurityFilterService (ë©”ì¸ ë³´ì•ˆ í•„í„°)
```dart
// lib/services/security_filter_service.dart
class SecurityFilterService {
  // ë©”ì¸ í•„í„° ë©”ì„œë“œ
  static String filterResponse({
    required String response,
    required String userMessage,
    required Persona persona,
  });
  
  // ë¬¸ë§¥ ì¸ì‹ í•„í„°
  static String filterResponseWithContext({
    required String response,
    required String userMessage,
    required Persona persona,
    List<String> recentMessages = const [],
  });
}
```

#### PromptInjectionDefense (ê³ ê¸‰ ì¸ì ì…˜ ë°©ì–´)
```dart
// lib/services/prompt_injection_defense.dart
class PromptInjectionDefense {
  // ì¸ì ì…˜ ê°ì§€ ë° ìœ„í—˜ë„ í‰ê°€
  static Future<InjectionAnalysis> analyzeInjection(String input);
  
  // ì—”íŠ¸ë¡œí”¼ ê¸°ë°˜ ë‚œìˆ˜ì„± ê°ì§€
  static double _calculateEntropy(String text);
}
```

#### SystemInfoProtection (ì‹œìŠ¤í…œ ì •ë³´ ë³´í˜¸)
```dart
// lib/services/system_info_protection.dart
class SystemInfoProtection {
  // ì‹œìŠ¤í…œ ì •ë³´ ì œê±°
  static String protectSystemInfo(String text);
  
  // ì •ë³´ ìœ ì¶œ ìœ„í—˜ë„ í‰ê°€
  static double assessLeakageRisk(String text);
}
```

#### SafeResponseGenerator (ì•ˆì „í•œ ì‘ë‹µ ìƒì„±)
```dart
// lib/services/safe_response_generator.dart
class SafeResponseGenerator {
  // ì¹´í…Œê³ ë¦¬ë³„ ì•ˆì „í•œ ì‘ë‹µ ìƒì„±
  static String generateSafeResponse({
    required Persona persona,
    required String category,
    String? userMessage,
  });
}
```

### 6. êµ¬í˜„ ê°€ì´ë“œë¼ì¸

#### ìƒˆ ì„œë¹„ìŠ¤ ìƒì„± ì‹œ
1. `BaseService` ìƒì†
2. ë¡œë”© ìƒíƒœê°€ í•„ìš”í•œ ì‘ì—…ì€ `executeWithLoading` ì‚¬ìš©
3. ì—ëŸ¬ í•¸ë“¤ë§ì´ í•„ìš”í•œ ì‘ì—…ì€ `executeSafely` ì‚¬ìš©

```dart
class NewService extends BaseService {
  Future<List<Item>> fetchItems() async {
    return await executeWithLoading(() async {
      final snapshot = await FirebaseHelper.items.get();
      return snapshot.docs.map((doc) => Item.fromJson(doc.data())).toList();
    });
  }
}
```

#### Firebase ì‘ì—… ì‹œ
1. `FirebaseHelper`ì˜ ì»¬ë ‰ì…˜ ì°¸ì¡° ì‚¬ìš©
2. íƒ€ì„ìŠ¤íƒ¬í”„ëŠ” `withTimestamps` ë©”ì„œë“œ ì‚¬ìš©
3. ë°°ì¹˜ ì‘ì—…ì€ `batch()` ë©”ì„œë“œ ì‚¬ìš©

#### ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì‹œ
1. ì•± ì‹œì‘ ì‹œ `PreferencesManager.initialize()` í˜¸ì¶œ
2. í‚¤ëŠ” `AppConstants`ì— ì •ì˜
3. íƒ€ì…ë³„ ë©”ì„œë“œ ì‚¬ìš© (setString, setInt, setBool ë“±)

#### ë³´ì•ˆ ê°•í™” êµ¬í˜„ ì‹œ
1. ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì€ `PromptInjectionDefense`ë¡œ ê²€ì¦
2. AI ì‘ë‹µì€ `SecurityFilterService`ë¡œ í•„í„°ë§
3. ì‹œìŠ¤í…œ ì •ë³´ëŠ” `SystemInfoProtection`ìœ¼ë¡œ ë³´í˜¸
4. ìœ„í—˜í•œ ìš”ì²­ì—ëŠ” `SafeResponseGenerator`ë¡œ ì‘ë‹µ

---

## ëŒ€í™” í’ˆì§ˆ ë¶„ì„ ì‹œìŠ¤í…œ

### ì—ëŸ¬ ë¶„ì„ ëª…ë ¹ì–´
**ëª…ë ¹ì–´**: `python scripts/analyze_chat_errors.py`

**ê¸°ëŠ¥**: 
- chat_error_fix ì»¬ë ‰ì…˜ì˜ ì˜¤ë¥˜ ë³´ê³ ì„œ ë¶„ì„
- ëŒ€í™” ë§¥ë½, ì¼ê´€ì„±, ìì—°ìŠ¤ëŸ¬ì›€ í‰ê°€
- ì‹¬ê°ë„ë³„ ë¬¸ì œ ë¶„ë¥˜ ë° ê°œì„  ì œì•ˆ

**ë¶„ì„ í•­ëª©**:

#### 1. ëŒ€í™” ë§¥ë½ ë¶„ì„ (ìµœìš°ì„ )
- **ì§ˆë¬¸-ë‹µë³€ ê´€ë ¨ì„± í‰ê°€**: ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì˜ ì ì ˆì„±
- **ì£¼ì œ ì¼ê´€ì„± ì ìˆ˜ (0-100)**: ëŒ€í™” ì „ì²´ì˜ ì£¼ì œ ì—°ì†ì„±
- **ëŒ€í™” íë¦„ ìì—°ìŠ¤ëŸ¬ì›€ ì ìˆ˜ (0-100)**: ì „í™˜ì˜ ë¶€ë“œëŸ¬ì›€
- **ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì£¼ì œ ë³€ê²½ ê°ì§€**: ë§¥ë½ ì—†ëŠ” ì£¼ì œ ì „í™˜

#### 2. íŒ¨í„´ ë¬¸ì œ ê°ì§€
- **ì¸ì‚¬ë§ ë°˜ë³µ**: ë™ì¼í•œ ì¸ì‚¬ ë°˜ë³µ ê°ì§€
- **ë§¤í¬ë¡œ ì‘ë‹µ**: ë™ì¼í•œ ì‘ë‹µ ë°˜ë³µ
- **ë°˜ë³µì  íŒ¨í„´**: ìœ ì‚¬í•œ êµ¬ì¡°ì˜ ì‘ë‹µ
- **ë¶ˆì¶©ë¶„í•œ ì‘ë‹µ**: ì§ˆë¬¸ ëŒ€ë¹„ ë„ˆë¬´ ì§§ì€ ë‹µë³€

#### 3. ì‹¬ê°ë„ ë ˆë²¨
- **CRITICAL**: ëŒ€í™” ì™„ì „ ì´íƒˆ, ì˜ë¯¸ ì—†ëŠ” ì‘ë‹µ
- **HIGH**: ì£¼ì œ ë²—ì–´ë‚¨, ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ì‘ë‹µ
- **MEDIUM**: ì•½ê°„ì˜ ë§¥ë½ ë¶ˆì¼ì¹˜
- **LOW**: ë¯¸ë¯¸í•œ ë¬¸ì œ

#### 4. ë¶„ì„ ê²°ê³¼ íŒŒì¼
- **ìš”ì•½ íŒŒì¼**: `analysis_results/summary_YYYYMMDD_HHMMSS.json`
  - ì „ì²´ í†µê³„
  - í˜ë¥´ì†Œë‚˜ë³„ í‰ê·  ì ìˆ˜
  - ì£¼ìš” ë¬¸ì œ ìœ í˜• ë¶„í¬
- **ìƒì„¸ íŒŒì¼**: `analysis_results/detailed_YYYYMMDD_HHMMSS.json`
  - ê°œë³„ ëŒ€í™” ë¶„ì„ ê²°ê³¼
  - ë¬¸ì œë³„ ìƒì„¸ ì„¤ëª…
  - ê°œì„  ì œì•ˆì‚¬í•­

#### 5. ì‹¤ì‹œê°„ ëŒ€í™” ê°œì„  ì‹œìŠ¤í…œ
ChatOrchestratorì˜ ë§¥ë½ ë¶„ì„ ê¸°ëŠ¥:
- **í‚¤ì›Œë“œ ì¶”ì¶œ**: ì‚¬ìš©ì ë©”ì‹œì§€ì˜ ì£¼ìš” ì£¼ì œ íŒŒì•…
- **ì£¼ì œ ë³€ê²½ ê°ì§€**: ì´ì „ ëŒ€í™”ì™€ì˜ ì—°ê´€ì„± ì²´í¬
- **íšŒí”¼ íŒ¨í„´ ê°ì§€**: ë‹µë³€ì„ í”¼í•˜ëŠ” íŒ¨í„´ ì¸ì‹
- **ì»¨í…ìŠ¤íŠ¸ íŒíŠ¸ ìƒì„±**: OpenAI APIì— ì£¼ì˜ì‚¬í•­ ì „ë‹¬
- **ë¬¸ì¥ ìœ ì‚¬ë„ ê³„ì‚°**: ë°˜ë³µì ì¸ ì§ˆë¬¸ ê°ì§€
- **êµ¬ì²´ì  ê°€ì´ë“œë¼ì¸**: ìƒí™©ë³„ ëŒ€í™” ê°œì„  íŒíŠ¸ ì œê³µ

#### 6. ëŒ€í™” ìì—°ìŠ¤ëŸ¬ì›€ ê°œì„  ì‚¬í•­
- **ë¶€ë“œëŸ¬ìš´ í‘œí˜„ ìš°ì„ **: ~ì–´ìš”?/~ì–´?/~ì£ ? > ~ë‚˜ìš”?/~ìŠµë‹ˆê¹Œ?
- **ì¹œê·¼í•œ ì§ˆë¬¸**: "ì–´ë• ì–´ìš”?", "ê´œì°®ì•˜ì–´?", "ì¬ë°Œì—ˆì–´ìš”?"
- **ë”±ë”±í•œ í‘œí˜„ ê¸ˆì§€**: "ë¬´ìŠ¨ ì ì´ ë§ˆìŒì— ë“¤ì—ˆë‚˜ìš”?" (X) â†’ "ë­ê°€ ì¢‹ì•˜ì–´ìš”?" (O)
- **ë§¥ë½ ìœ ì§€ ê°•í™”**: ì´ì „ ëŒ€í™” ë‚´ìš© ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ê°€ê¸°
- **ê¸‰ê²©í•œ ì£¼ì œ ë³€ê²½ ì²˜ë¦¬**: ë¶€ë“œëŸ¬ìš´ ì „í™˜ ë˜ëŠ” ì´ì „ ì£¼ì œì™€ ì—°ê²°

#### 7. ì˜ë¬¸ë¬¸ ìë™ êµì • ì‹œìŠ¤í…œ
SecurityAwarePostProcessorì—ì„œ API í˜¸ì¶œ ì „ ì˜ë¬¸ë¬¸ ì²˜ë¦¬:
- **ì˜ë¬¸ë¬¸ ê°ì§€**: ì˜ë¬¸ì‚¬ + ì˜ë¬¸í˜• ì–´ë¯¸ íŒ¨í„´ ë¶„ì„
- **ë¬¼ìŒí‘œ ìë™ ì¶”ê°€**: "ë¬´ìŠ¨ ì ì´ ë§ˆìŒì— ë“¤ì—ˆë‚˜ìš”." â†’ "ë¬´ìŠ¨ ì ì´ ë§ˆìŒì— ë“¤ì—ˆë‚˜ìš”?"
- **ã…‹ã…‹/ã…ã… ì²˜ë¦¬**: "ë­í•´ã…‹ã…‹" â†’ "ë­í•´?ã…‹ã…‹"
- **ë³µí•© ë¬¸ì¥ ì²˜ë¦¬**: ë§ˆì§€ë§‰ ë¬¸ì¥ë§Œ ì˜ë¬¸ë¬¸ì¸ ê²½ìš° ì •í™•íˆ ì²˜ë¦¬
- **ë¶€ë“œëŸ¬ìš´ í‘œí˜„ ë³€í™˜**: ë”±ë”±í•œ í‘œí˜„ì„ ìë™ìœ¼ë¡œ ì¹œê·¼í•˜ê²Œ ë³€í™˜

**ì§€ì›í•˜ëŠ” ì˜ë¬¸í˜• íŒ¨í„´**:
- ì˜ë¬¸ì‚¬: ë­, ì–´ë””, ì–¸ì œ, ëˆ„êµ¬, ì™œ, ì–´ë–»ê²Œ, ì–¼ë§ˆ, ëª‡, ì–´ëŠ, ë¬´ìŠ¨, ë¬´ì—‡
- ì˜ë¬¸ ì–´ë¯¸: ~ë‹ˆ, ~ë‚˜ìš”, ~ê¹Œ, ~ê¹Œìš”, ~ì–´ìš”, ~ì„ê¹Œ, ~ëŠ”ì§€, ~ì€ì§€, ~ë‚˜, ~ëƒ, ~ì–´, ~ì•¼, ~ì§€, ~ì£  ë“±
- íŠ¹ìˆ˜ íŒ¨í„´: "~í•˜ëŠ” ê±°", "~í•˜ëŠ” ê±´", "~ì¸ ê±°", "~ì¸ ê±´"

**ë¶€ë“œëŸ¬ìš´ í‘œí˜„ ë³€í™˜ ì˜ˆì‹œ**:
- "ë¬´ìŠ¨ ì ì´ ë§ˆìŒì— ë“¤ì—ˆë‚˜ìš”?" â†’ "ë­ê°€ ì¢‹ì•˜ì–´ìš”?"
- "ì–´ë–»ê²Œ ìƒê°í•˜ì‹œë‚˜ìš”?" â†’ "ì–´ë–»ê²Œ ìƒê°í•´ìš”?"
- "ê´œì°®ìœ¼ì‹ ê°€ìš”?" â†’ "ê´œì°®ì•„ìš”?"
- "~ë‚˜ìš”?" â†’ "~ì–´ìš”?"
- "~ìŠµë‹ˆê¹Œ?" â†’ "~ì–´ìš”?"

**ì‚¬ìš© ì˜ˆì‹œ**:
```bash
# ê¸°ë³¸ ë¶„ì„ (ì²´í¬ ì•ˆ ëœ ë¬¸ì„œë§Œ)
python scripts/analyze_chat_errors.py

# ëª¨ë“  ë¬¸ì„œ ì¬ë¶„ì„
python scripts/analyze_chat_errors.py --recheck
```

---

## ìë™í™” ëª…ë ¹ì–´

### ì´ë¯¸ì§€ ìµœì í™”
**ëª…ë ¹ì–´**: `ì´ë¯¸ì§€ ìµœì í™”`

**ê¸°ëŠ¥**: 
- `C:\Users\yong\Documents\personas` í´ë”ì˜ **ëª¨ë“ ** í˜ë¥´ì†Œë‚˜ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ì—ì„œ ìµœì í™”
- ì´ë¯¸ì§€ê°€ ìˆëŠ” ëª¨ë“  í´ë” ìë™ ê°ì§€ ë° ì²˜ë¦¬
- **í•œê¸€ í´ë”ëª…ì„ ì˜ë¬¸ìœ¼ë¡œ ìë™ ë³€í™˜** (ì˜ˆ: ìƒí›ˆ -> sanghoon)
- 5ê°€ì§€ í¬ê¸°ë¡œ ìµœì í™” (thumb: 150px, small: 300px, medium: 600px, large: 1200px, original)
- ê³ í’ˆì§ˆ JPEG í˜•ì‹ìœ¼ë¡œ ìƒì„± (í’ˆì§ˆ: 95, ì›ë³¸: 98)
- **`assets/personas` í´ë”ì— ì˜ë¬¸ í´ë”ëª…ìœ¼ë¡œ ì €ì¥**
- ìˆ˜ë™ìœ¼ë¡œ Cloudflare R2ì— ì—…ë¡œë“œ í›„ 'ì´ë¯¸ì§€ ë°˜ì˜' ëª…ë ¹ì–´ ì‚¬ìš©

**ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸**: 
`python scripts/local_image_optimizer_english.py`

**í•œê¸€-ì˜ë¬¸ ë§¤í•‘**:

**í”„ë¡œì„¸ìŠ¤**:
1. **ì´ë¯¸ì§€ ìµœì í™” (ë¡œì»¬)**
   - `C:\Users\yong\Documents\personas` ë‚´ ëª¨ë“  ë””ë ‰í† ë¦¬ ê²€ì‚¬
   - ì´ë¯¸ì§€ íŒŒì¼ì´ ìˆëŠ” í´ë”ë§Œ ìë™ ì„ ë³„
   - í•œê¸€ í´ë”ëª…ì„ ì˜ë¬¸ìœ¼ë¡œ ìë™ ë³€í™˜
   - ê° í´ë”ì˜ ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ 5ê°€ì§€ í¬ê¸°ë¡œ ìµœì í™”
   - `assets/personas/{ì˜ë¬¸ëª…}/main_{í¬ê¸°}.jpg` í˜•íƒœë¡œ ì €ì¥

2. **ìˆ˜ë™ R2 ì—…ë¡œë“œ**
   - `assets/personas` í´ë”ì˜ ë‚´ìš©ì„ Cloudflare R2ì— ìˆ˜ë™ ì—…ë¡œë“œ
   - ê²½ë¡œ êµ¬ì¡°: `personas/{ì˜ë¬¸ëª…}/main_{í¬ê¸°}.jpg`

3. **Firebase ë°˜ì˜ ('ì´ë¯¸ì§€ ë°˜ì˜' ëª…ë ¹ì–´)**
   - R2ì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ê²½ë¡œ í™•ì¸
   - Firebase personas ì»¬ë ‰ì…˜ì˜ imageUrls í•„ë“œ ì—…ë°ì´íŠ¸
   - ì˜ë¬¸ í´ë”ëª… ê¸°ë°˜ URL ì‚¬ìš©

**ìµœì¢… imageUrls êµ¬ì¡°**:
```json
{
  "imageUrls": {
    "thumb": {"jpg": "https://teamsona.work/personas/ì˜ë¬¸ëª…/main_thumb.jpg"},
    "small": {"jpg": "https://teamsona.work/personas/ì˜ë¬¸ëª…/main_small.jpg"},
    "medium": {"jpg": "https://teamsona.work/personas/ì˜ë¬¸ëª…/main_medium.jpg"},
    "large": {"jpg": "https://teamsona.work/personas/ì˜ë¬¸ëª…/main_large.jpg"},
    "original": {"jpg": "https://teamsona.work/personas/ì˜ë¬¸ëª…/main_original.jpg"}
  },
  "updatedAt": "2025-01-27T16:30:00.000Z"
}
```

ì˜ˆì‹œ (ìƒí›ˆ):
```json
{
  "imageUrls": {
    "thumb": {"jpg": "https://teamsona.work/personas/sanghoon/main_thumb.jpg"},
    "small": {"jpg": "https://teamsona.work/personas/sanghoon/main_small.jpg"},
    "medium": {"jpg": "https://teamsona.work/personas/sanghoon/main_medium.jpg"},
    "large": {"jpg": "https://teamsona.work/personas/sanghoon/main_large.jpg"},
    "original": {"jpg": "https://teamsona.work/personas/sanghoon/main_original.jpg"}
  }
}
```

---

## Firebase ì¸ë±ìŠ¤ ê´€ë¦¬

### ì¸ë±ìŠ¤ ìë™ ìƒì„±
Firebase Firestoreì˜ ë³µí•© ì¸ë±ìŠ¤ëŠ” `firestore.indexes.json` íŒŒì¼ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**í˜„ì¬ ì •ì˜ëœ ì¸ë±ìŠ¤:**
1. **conversation_memories** ì»¬ë ‰ì…˜
   - userId (ASC) + personaId (ASC) + importance (DESC) + timestamp (DESC)
   - ìš©ë„: ëŒ€í™” ê¸°ì–µ ê²€ìƒ‰ ë° ì •ë ¬

2. **conversation_summaries** ì»¬ë ‰ì…˜
   - userId (ASC) + personaId (ASC) + endDate (DESC)
   - ìš©ë„: ëŒ€í™” ìš”ì•½ ê²€ìƒ‰ ë° ìµœì‹  ìš”ì•½ ì¡°íšŒ

**ì¸ë±ìŠ¤ ë°°í¬ ëª…ë ¹ì–´:**
```bash
firebase deploy --only firestore:indexes
```

**ì£¼ì˜ì‚¬í•­:**
- ë‹¨ì¼ í•„ë“œ ì¸ë±ìŠ¤ëŠ” Firebaseê°€ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤ (ì˜ˆ: messages.timestamp)
- ìƒˆë¡œìš´ ë³µí•© ì¿¼ë¦¬ ì¶”ê°€ ì‹œ firestore.indexes.json ì—…ë°ì´íŠ¸ í•„ìš”
- í˜ë¥´ì†Œë‚˜ì™€ ìœ ì € ì¡°í•©ì´ ë¬´í•œí•´ë„ ì¸ë±ìŠ¤ëŠ” ë™ì¼í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤

---

### ì´ë¯¸ì§€ ë°˜ì˜
**ëª…ë ¹ì–´**: `ì´ë¯¸ì§€ ë°˜ì˜`

**ê¸°ëŠ¥**: 
- Cloudflare R2ì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ Firebaseì— ë°˜ì˜
- `assets/personas` í´ë” êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í˜ë¥´ì†Œë‚˜ í™•ì¸
- Firebase personas ì»¬ë ‰ì…˜ì˜ imageUrls í•„ë“œ ì—…ë°ì´íŠ¸
- ì—…ë°ì´íŠ¸ ì‹œê°„ ìë™ ê¸°ë¡

**ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸**: 
`python scripts/firebase_image_updater_english.py`

**ì‚¬ì „ ìš”êµ¬ì‚¬í•­**:
- 'ì´ë¯¸ì§€ ìµœì í™”' ëª…ë ¹ì–´ ì‹¤í–‰ ì™„ë£Œ
- assets/personas í´ë”ì˜ ì´ë¯¸ì§€ë¥¼ Cloudflare R2ì— ìˆ˜ë™ ì—…ë¡œë“œ ì™„ë£Œ

**í”„ë¡œì„¸ìŠ¤**:
1. **í˜ë¥´ì†Œë‚˜ ìŠ¤ìº”**
   - `assets/personas` í´ë”ì˜ í•˜ìœ„ ë””ë ‰í† ë¦¬ í™•ì¸
   - 5ê°€ì§€ í¬ê¸°ì˜ ì´ë¯¸ì§€ íŒŒì¼ì´ ëª¨ë‘ ìˆëŠ” í˜ë¥´ì†Œë‚˜ë§Œ ì„ íƒ

2. **Firebase ì—…ë°ì´íŠ¸**
   - ê° í˜ë¥´ì†Œë‚˜ì˜ Firebase ë¬¸ì„œ ì¡°íšŒ
   - imageUrls í•„ë“œë¥¼ R2 URL êµ¬ì¡°ë¡œ ì—…ë°ì´íŠ¸
   - ì—…ë°ì´íŠ¸ ì‹œê°„ ê¸°ë¡
   - ìƒì„±ëœ ì„ì‹œ JSON íŒŒì¼ ì‚­ì œ

**ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸**: 
```bash
# 1ë‹¨ê³„: ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ë¡œì»¬ ìƒì„±
python scripts/upload_persona_images_to_r2.py

# 2ë‹¨ê³„: R2 ì—…ë¡œë“œ ë° Firebase ì—…ë°ì´íŠ¸ (ìë™í™” ì˜ˆì •)
# í˜„ì¬ëŠ” ìˆ˜ë™ìœ¼ë¡œ MCP ëª…ë ¹ ì‹¤í–‰ í•„ìš”

# 3ë‹¨ê³„: ì„ì‹œ íŒŒì¼ ì •ë¦¬
powershell -Command "Get-ChildItem -Path . -Filter '*.webp' | Remove-Item -Force; Get-ChildItem -Path . -Filter '*.jpg' | Remove-Item -Force; Get-ChildItem -Path . -Filter '*_results.json' | Remove-Item -Force"
```

**ì£¼ì˜ì‚¬í•­**:
- Windows í™˜ê²½ì—ì„œ í•œê¸€ í´ë”ëª… ì¸ì½”ë”© ë¬¸ì œ ìˆì„ ìˆ˜ ìˆìŒ
- R2 ì—…ë¡œë“œ ì‹œ URL ì¸ì½”ë”© ìë™ ì²˜ë¦¬ë¨
- Firebase MCPê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨
- Cloudflare R2 MCPê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨

## í´ë¡œë“œ ì½”ë“œì—ì„œì˜ mcp-installerë¥¼ ì‚¬ìš©í•œ MCP (Model Context Protocol) ì„¤ì¹˜ ë° ì„¤ì • ê°€ì´ë“œ 
ê³µí†µ ì£¼ì˜ì‚¬í•­
1. í˜„ì¬ ì‚¬ìš© í™˜ê²½ì„ í™•ì¸í•  ê²ƒ. ëª¨ë¥´ë©´ ì‚¬ìš©ìì—ê²Œ ë¬¼ì–´ë³¼ ê²ƒ. 
2. OS(ìœˆë„ìš°,ë¦¬ëˆ…ìŠ¤,ë§¥) ë° í™˜ê²½ë“¤(WSL,íŒŒì›Œì…€,ëª…ë ¹í”„ë¡¬í”„íŠ¸ë“±)ì„ íŒŒì•…í•´ì„œ ê·¸ì— ë§ê²Œ ì„¸íŒ…í•  ê²ƒ. ëª¨ë¥´ë©´ ì‚¬ìš©ìì—ê²Œ ë¬¼ì–´ë³¼ ê²ƒ.
3. mcp-installerì„ ì´ìš©í•´ í•„ìš”í•œ MCPë“¤ì„ ì„¤ì¹˜í•  ê²ƒ
   (user ìŠ¤ì½”í”„ë¡œ ì„¤ì¹˜ ë° ì ìš©í• ê²ƒ)
4. íŠ¹ì • MCP ì„¤ì¹˜ì‹œ, ë°”ë¡œ ì„¤ì¹˜í•˜ì§€ ë§ê³ , WebSearch ë„êµ¬ë¡œ í•´ë‹¹ MCPì˜ ê³µì‹ ì‚¬ì´íŠ¸ í™•ì¸í•˜ê³  í˜„ì¬ OS ë° í™˜ê²½ ë§¤ì¹˜í•˜ì—¬, ê³µì‹ ì„¤ì¹˜ë²•ë¶€í„° í™•ì¸í•  ê²ƒ
5. ê³µì‹ ì‚¬ì´íŠ¸ í™•ì¸ í›„ì—ëŠ” context7 MCP ì¡´ì¬í•˜ëŠ” ê²½ìš°, context7ìœ¼ë¡œ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•  ê²ƒ
6. MCP ì„¤ì¹˜ í›„, taskë¥¼ í†µí•´ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì„œë¸Œ ì—ì´ì „íŠ¸ êµ¬ë™í•œ í›„, /mcp ë¥¼ í†µí•´ ì‹¤ì œ ì‘ë™ì—¬ë¶€ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•  ê²ƒ 
7. ì„¤ì • ì‹œ, API KEY í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš°, ê°€ìƒì˜ API í‚¤ë¡œ ë””í´íŠ¸ë¡œ ì„¤ì¹˜ ë° ì„¤ì • í›„, ì˜¬ë°”ë¥¸ API í‚¤ ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ í•¨ì„ ì‚¬ìš©ìì—ê²Œ ì•Œë¦´ ê²ƒ
8. Mysql MCPì™€ ê°™ì´ íŠ¹ì • ì„œë²„ê°€ êµ¬ë™ì¤‘ ìƒíƒœì—¬ë§Œ ì •ìƒ ì‘ë™í•œ ê²ƒì€ ì—ëŸ¬ê°€ ë‚˜ë„ ì¬ì„¤ì¹˜í•˜ì§€ ë§ê³ , ì •ìƒ êµ¬ë™ì„ ìœ„í•œ ì¡°ê±´ì„ ì‚¬ìš©ìì—ê²Œ ì•Œë¦´ ê²ƒ
9. í˜„ì¬ í´ë¡œë“œ ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì´ì•¼.
10. ì„¤ì¹˜ ìš”ì²­ ë°›ì€ MCPë§Œ ì„¤ì¹˜í•˜ë©´ ë¼. í˜¹ì‹œ ì´ë¯¸ ì„¤ì¹˜ëœ ë‹¤ë¥¸ MCP ì—ëŸ¬ ìˆì–´ë„, ê·¸ëƒ¥ ë‘˜ ê²ƒ
11. ì¼ë‹¨, í„°ë¯¸ë„ì—ì„œ ì„¤ì¹˜í•˜ë ¤ëŠ” MCP ì‘ë™ ì„±ê³µí•œ ê²½ìš°, ì„±ê³µ ì‹œì˜ ì¸ì ë° í™˜ê²½ ë³€ìˆ˜ ì´ë¦„ì„ í™œìš©í•´, ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì˜ json íŒŒì¼ì— MCP ì„¤ì •ì„ ì§ì ‘í•  ê²ƒ
12. WSL sudo íŒ¨ìŠ¤ì›Œë“œ: qsc1555 (ì´ê³³ì— wsl ì„¤ì¹˜ ì‹œì—, ì…ë ¥í•œ ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ì…ë ¥í•˜ì„¸ìš”. ìœˆë„ìš° ë„¤ì´í‹°ë¸Œ í™˜ê²½ì´ì‹œë©´ ì´ ë‚´ìš© ë¹¼ì‹œë©´ ë©ë‹ˆë‹¤ )

*ìœˆë„ìš°ì—ì„œì˜ ì£¼ì˜ì‚¬í•­*
1. ì„¤ì • íŒŒì¼ ì§ì ‘ ì„¸íŒ…ì‹œ, Windows ê²½ë¡œ êµ¬ë¶„ìëŠ” ë°±ìŠ¬ë˜ì‹œ(\)ì´ë©°, JSON ë‚´ì—ì„œëŠ” ë°˜ë“œì‹œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬(\\\\)í•´ì•¼ í•´.
** OS ê³µí†µ ì£¼ì˜ì‚¬í•­**
1. Node.jsê°€ %PATH%ì— ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€, ë²„ì „ì´ ìµœì†Œ v18 ì´ìƒì¸ì§€ í™•ì¸í•  ê²ƒ
2. npx -y ì˜µì…˜ì„ ì¶”ê°€í•˜ë©´ ë²„ì „ í˜¸í™˜ì„± ë¬¸ì œë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŒ

### MCP ì„œë²„ ì„¤ì¹˜ ìˆœì„œ

1. ê¸°ë³¸ ì„¤ì¹˜
	mcp-installerë¥¼ ì‚¬ìš©í•´ ì„¤ì¹˜í•  ê²ƒ

2. ì„¤ì¹˜ í›„ ì •ìƒ ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸í•˜ê¸°	
	claude mcp list ìœ¼ë¡œ ì„¤ì¹˜ ëª©ë¡ì— í¬í•¨ë˜ëŠ”ì§€ ë‚´ìš© í™•ì¸í•œ í›„,
	taskë¥¼ í†µí•´ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì„œë¸Œ ì—ì´ì „íŠ¸ êµ¬ë™í•œ í›„ (claude --debug), ìµœëŒ€ 2ë¶„ ë™ì•ˆ ê´€ì°°í•œ í›„, ê·¸ ë™ì•ˆì˜ ë””ë²„ê·¸ ë©”ì‹œì§€(ì—ëŸ¬ ì‹œ ê´€ë ¨ ë‚´ìš©ì´ ì¶œë ¥ë¨)ë¥¼ í™•ì¸í•˜ê³  /mcp ë¥¼ í†µí•´(Bash(echo "/mcp" | claude --debug)) ì‹¤ì œ ì‘ë™ì—¬ë¶€ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•  ê²ƒ

3. ë¬¸ì œ ìˆì„ë•Œ ë‹¤ìŒì„ í†µí•´ ì§ì ‘ ì„¤ì¹˜í•  ê²ƒ

	*User ìŠ¤ì½”í”„ë¡œ claude mcp add ëª…ë ¹ì–´ë¥¼ í†µí•œ ì„¤ì • íŒŒì¼ ì„¸íŒ… ì˜ˆì‹œ*
	ì˜ˆì‹œ1:
	claude mcp add --scope user youtube-mcp \
	  -e YOUTUBE_API_KEY=$YOUR_YT_API_KEY \

	  -e YOUTUBE_TRANSCRIPT_LANG=ko \
	  -- npx -y youtube-data-mcp-server


4. ì •ìƒ ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸ í•˜ê¸°
	claude mcp list ìœ¼ë¡œ ì„¤ì¹˜ ëª©ë¡ì— í¬í•¨ë˜ëŠ”ì§€ ë‚´ìš© í™•ì¸í•œ í›„,
	taskë¥¼ í†µí•´ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì„œë¸Œ ì—ì´ì „íŠ¸ êµ¬ë™í•œ í›„ (claude --debug), ìµœëŒ€ 2ë¶„ ë™ì•ˆ ê´€ì°°í•œ í›„, ê·¸ ë™ì•ˆì˜ ë””ë²„ê·¸ ë©”ì‹œì§€(ì—ëŸ¬ ì‹œ ê´€ë ¨ ë‚´ìš©ì´ ì¶œë ¥ë¨)ë¥¼ í™•ì¸í•˜ê³ , /mcp ë¥¼ í†µí•´(Bash(echo "/mcp" | claude --debug)) ì‹¤ì œ ì‘ë™ì—¬ë¶€ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•  ê²ƒ


5. ë¬¸ì œ ìˆì„ë•Œ ê³µì‹ ì‚¬ì´íŠ¸ ë‹¤ì‹œ í™•ì¸í›„ ê¶Œì¥ë˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì„¤ì¹˜ ë° ì„¤ì •í•  ê²ƒ
	(npm/npx íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°) pm ì „ì—­ ì„¤ì¹˜ ê²½ë¡œ í™•ì¸ : npm config get prefix
	ê¶Œì¥ë˜ëŠ” ë°©ë²•ì„ í™•ì¸í•œ í›„, npm, pip, uvx, pip ë“±ìœ¼ë¡œ ì§ì ‘ ì„¤ì¹˜í•  ê²ƒ

	#### uvx ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
	# uv ì„¤ì¹˜ (Python íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
	curl -LsSf https://astral.sh/uv/install.sh | sh

	#### npm/npx íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
	# npm ì „ì—­ ì„¤ì¹˜ ê²½ë¡œ í™•ì¸
	npm config get prefix


	#### uvx ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
	# uv ì„¤ì¹˜ (Python íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
	curl -LsSf https://astral.sh/uv/install.sh | sh


	## ì„¤ì¹˜ í›„ í„°ë¯¸ë„ ìƒì—ì„œ ì‘ë™ ì—¬ë¶€ ì ê²€í•  ê²ƒ ##
	
	## ìœ„ ë°©ë²•ìœ¼ë¡œ, í„°ë¯¸ë„ì—ì„œ ì‘ë™ ì„±ê³µí•œ ê²½ìš°, ì„±ê³µ ì‹œì˜ ì¸ì ë° í™˜ê²½ ë³€ìˆ˜ ì´ë¦„ì„ í™œìš©í•´ì„œ, í´ë¡œë“œ ì½”ë“œì˜ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì˜ json ì„¤ì • íŒŒì¼ì— MCPë¥¼ ì§ì ‘ ì„¤ì •í•  ê²ƒ ##


	ì„¤ì • ì˜ˆì‹œ
		(ì„¤ì • íŒŒì¼ ìœ„ì¹˜)
		***ë¦¬ëˆ…ìŠ¤, macOS ë˜ëŠ” ìœˆë„ìš° WSL ê¸°ë°˜ì˜ í´ë¡œë“œ ì½”ë“œì¸ ê²½ìš°***
		- **User ì„¤ì •**: `~/.claude/` ë””ë ‰í† ë¦¬
		- **Project ì„¤ì •**: í”„ë¡œì íŠ¸ ë£¨íŠ¸/.claude

		***ìœˆë„ìš° ë„¤ì´í‹°ë¸Œ í´ë¡œë“œ ì½”ë“œì¸ ê²½ìš°***
		- **User ì„¤ì •**: `C:\Users\{ì‚¬ìš©ìëª…}\.claude` ë””ë ‰í† ë¦¬
		- **Project ì„¤ì •**: í”„ë¡œì íŠ¸ ë£¨íŠ¸\.claude

		1. npx ì‚¬ìš©

		{
		  "youtube-mcp": {
		    "type": "stdio",
		    "command": "npx",
		    "args": ["-y", "youtube-data-mcp-server"],
		    "env": {
		      "YOUTUBE_API_KEY": "YOUR_API_KEY_HERE",
		      "YOUTUBE_TRANSCRIPT_LANG": "ko"
		    }
		  }
		}


		2. cmd.exe ë˜í¼ + ìë™ ë™ì˜)
		{
		  "mcpServers": {
		    "mcp-installer": {
		      "command": "cmd.exe",
		      "args": ["/c", "npx", "-y", "@anaisbetts/mcp-installer"],
		      "type": "stdio"
		    }
		  }
		}

		3. íŒŒì›Œì…€ì˜ˆì‹œ
		{
		  "command": "powershell.exe",
		  "args": [
		    "-NoLogo", "-NoProfile",
		    "-Command", "npx -y @anaisbetts/mcp-installer"
		  ]
		}

		4. npx ëŒ€ì‹  node ì§€ì •
		{
		  "command": "node",
		  "args": [
		    "%APPDATA%\\npm\\node_modules\\@anaisbetts\\mcp-installer\\dist\\index.js"
		  ]
		}

		5. args ë°°ì—´ ì„¤ê³„ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸
		í† í° ë‹¨ìœ„ ë¶„ë¦¬: "args": ["/c","npx","-y","pkg"] ì™€
			"args": ["/c","npx -y pkg"] ëŠ” ë™ì¼í•´ë³´ì—¬ë„â€¯cmd.exe ë‚´ë¶€ì—ì„œ ë”°ì˜´í‘œ ì²˜ë¦¬ ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ. ë¶„ë¦¬ê°€ ì•ˆì „.
		ê²½ë¡œ í¬í•¨ ì‹œ: JSONì—ì„œëŠ” \\ ë‘â€¯ë²ˆ. ì˜ˆ) "C:\\tools\\mcp\\server.js".
		í™˜ê²½ë³€ìˆ˜ ì „ë‹¬:
			"env": { "UV_DEPS_CACHE": "%TEMP%\\uvcache" }
		íƒ€ì„ì•„ì›ƒ ì¡°ì •: ëŠë¦° PCë¼ë©´ MCP_TIMEOUT í™˜ê²½ë³€ìˆ˜ë¡œ ë¶€íŒ… ìµœëŒ€â€¯ì‹œê°„ì„ ëŠ˜ë¦´ ìˆ˜ ìˆìŒ (ì˜ˆ: 10000 = 10â€¯ì´ˆ) 

(ì„¤ì¹˜ ë° ì„¤ì •í•œ í›„ëŠ” í•­ìƒ ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ ê²€ì¦í•  ê²ƒ)
	claude mcp list ìœ¼ë¡œ ì„¤ì¹˜ ëª©ë¡ì— í¬í•¨ë˜ëŠ”ì§€ ë‚´ìš© í™•ì¸í•œ í›„,
	taskë¥¼ í†µí•´ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì„œë¸Œ ì—ì´ì „íŠ¸ êµ¬ë™í•œ í›„ (claude --debug), ìµœëŒ€ 2ë¶„ ë™ì•ˆ ê´€ì°°í•œ í›„, ê·¸ ë™ì•ˆì˜ ë””ë²„ê·¸ ë©”ì‹œì§€(ì—ëŸ¬ ì‹œ ê´€ë ¨ ë‚´ìš©ì´ ì¶œë ¥ë¨)ë¥¼ í™•ì¸í•˜ê³  /mcp ë¥¼ í†µí•´ ì‹¤ì œ ì‘ë™ì—¬ë¶€ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•  ê²ƒ


		
** MCP ì„œë²„ ì œê±°ê°€ í•„ìš”í•  ë•Œ ì˜ˆì‹œ: **
claude mcp remove youtube-mcp

** firebase mcp ì ê·¹ í™œìš©í•  ê²ƒ **

** Serena MCP ì ê·¹ í™œìš©í•  ê²ƒ **
Serena MCPëŠ” ê°•ë ¥í•œ ì½”ë”© ì—ì´ì „íŠ¸ íˆ´í‚·ìœ¼ë¡œ ì˜ë¯¸ë¡ ì  ì½”ë“œ ê²€ìƒ‰ ë° í¸ì§‘ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### Serena MCP ì£¼ìš” ê¸°ëŠ¥:
- **ì˜ë¯¸ë¡ ì  ì½”ë“œ ë¶„ì„**: ì–¸ì–´ ì„œë²„ í”„ë¡œí† ì½œì„ í†µí•œ IDE ìˆ˜ì¤€ì˜ ì½”ë“œ ì´í•´
- **ë‹¤ì¤‘ ì–¸ì–´ ì§€ì›**: ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì— ëŒ€í•œ ì§€ì›
- **ëŒ€í˜• ì½”ë“œë² ì´ìŠ¤ ì²˜ë¦¬**: ë³µì¡í•œ ì½”ë”© ì‘ì—…ì— íŠ¹í™”ëœ ì„±ëŠ¥
- **ì›¹ ëŒ€ì‹œë³´ë“œ**: http://127.0.0.1:24282/dashboard/index.html ì—ì„œ ë¡œê·¸ ë° ìƒíƒœ í™•ì¸ ê°€ëŠ¥

### Serena MCP ì„¤ì¹˜ ë°©ë²•:
```bash
# ê¶Œì¥ ì„¤ì¹˜ ë°©ë²• (IDE ì–´ì‹œìŠ¤í„´íŠ¸ ì»¨í…ìŠ¤íŠ¸ì™€ í˜„ì¬ í”„ë¡œì íŠ¸ ê²½ë¡œ í¬í•¨)
claude mcp add serena -- uvx --from git+https://github.com/oraios/serena serena-mcp-server --context ide-assistant --project "%cd%"

# ë˜ëŠ” ê¸°ë³¸ ì„¤ì¹˜
claude mcp add serena -- uvx --from git+https://github.com/oraios/serena serena-mcp-server
```

### Serena MCP ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­:
1. **uv íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € í•„ìš”**: SerenaëŠ” uvë¡œ ê´€ë¦¬ë˜ë¯€ë¡œ ì‚¬ì „ ì„¤ì¹˜ í•„ìš”
2. **ì´ˆê¸° ì—°ê²° ì‹œê°„**: ì²« ì„¤ì¹˜ ì‹œ ì˜ì¡´ì„± ì„¤ì¹˜ë¡œ ì¸í•´ 30ì´ˆ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŒ
3. **í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸**: --context ide-assistant ì˜µì…˜ ì‚¬ìš© ê¶Œì¥
4. **ì›¹ ëŒ€ì‹œë³´ë“œ**: ê¸°ë³¸ì ìœ¼ë¡œ ë¡œì»¬í˜¸ìŠ¤íŠ¸ì— ëŒ€ì‹œë³´ë“œê°€ ì‹œì‘ë˜ì–´ ë¡œê·¸ ë° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

### Serena MCP ì„¤ì • ì˜ˆì‹œ (ìˆ˜ë™ ì„¤ì • ì‹œ):
```json
{
  "serena": {
    "command": "uvx",
    "args": [
      "--from",
      "git+https://github.com/oraios/serena",
      "serena-mcp-server",
      "--context",
      "ide-assistant",
      "--project",
      "C:\\Users\\yong\\sonaapp"
    ],
    "type": "stdio"
  }
}
```

### í˜„ì¬ í”„ë¡œì íŠ¸ Serena MCP ì„¤ì • ìƒíƒœ:
- **ì„¤ì¹˜ ìƒíƒœ**: âœ… ì™„ë£Œ (ì •ìƒ ì—°ê²°)
- **í”„ë¡œì íŠ¸ ê²½ë¡œ**: `C:\Users\yong\sonaapp` (ì ˆëŒ€ ê²½ë¡œë¡œ ì„¤ì •ë¨)
- **ì›¹ ëŒ€ì‹œë³´ë“œ**: http://127.0.0.1:24283/dashboard/index.html
- **ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬**: 27ê°œ (semantic ì½”ë“œ ë¶„ì„, ì‹¬ë³¼ ê²€ìƒ‰, ë©”ëª¨ë¦¬ ê´€ë¦¬ ë“±)
- **ì„¤ì • íŒŒì¼**: User ìŠ¤ì½”í”„ë¡œ ì„¤ì¹˜ë˜ì–´ Claude ì¬ì‹œì‘ ì‹œ ìë™ ì—°ê²°

### Serena MCP ìë™ ì—°ê²° í™•ì¸:
ë‹¤ìŒ Claude ì„¸ì…˜ë¶€í„°ëŠ” ìë™ìœ¼ë¡œ Serena MCPê°€ ì—°ê²°ë©ë‹ˆë‹¤:
1. **User ì„¤ì •ì— ì €ì¥ë¨**: `C:\Users\yong\.claude\mcp_servers.json`ì— ì„¤ì • ì €ì¥
2. **ìë™ ì‹œì‘**: Claude ì½”ë“œ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Serena MCP ì„œë²„ ì‹œì‘
3. **ì—°ê²° í™•ì¸**: `/mcp` ëª…ë ¹ìœ¼ë¡œ ì—°ê²° ìƒíƒœ í™•ì¸ ê°€ëŠ¥
4. **ì›¹ ëŒ€ì‹œë³´ë“œ**: ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ ë° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

** scripts/process_persona_image.py íŒŒì¼ í™œìš©í•˜ì—¬ cloudflare mcpë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì´ë¯¸ì§€ ì²˜ë¦¬í•  ê²ƒ **

** test ìš©ë„ë¡œ ìƒì„±í•œ íŒŒì¼ë“¤ì€ testê°€ ëë‚˜ë©´ ì‚­ì œí•  ê²ƒ **

---

## ì¤‘ë³µ ë§¤ì¹­ ë°©ì§€ ì‹œìŠ¤í…œ

**ë¬¸ì œ**: ì´ë¯¸ ëŒ€í™”ì¤‘ì¸ í˜ë¥´ì†Œë‚˜ê°€ ì¹´ë“œì— ë‹¤ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ë²„ê·¸ë¡œ ì‚¬ìš©ìê°€ í•˜íŠ¸ë¥¼ ë‚­ë¹„í•˜ê²Œ ë¨

**í•´ê²°ì±…**:
1. **PersonaService.matchWithPersona()**: ë§¤ì¹­ ì „ ì¤‘ë³µ í™•ì¸ ì¶”ê°€
   ```dart
   if (_matchedPersonas.any((p) => p.id == personaId)) {
     debugPrint('âš ï¸ Already matched with persona: $personaId');
     return false;
   }
   ```

2. **PersonaSelectionScreen._showMatchDialog()**: ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ ì „ ì¤‘ë³µ í™•ì¸
   ```dart
   if (personaService.matchedPersonas.any((p) => p.id == persona.id)) {
     ScaffoldMessenger.of(context).showSnackBar(
       SnackBar(content: Text('${persona.name}ë‹˜ê³¼ëŠ” ì´ë¯¸ ëŒ€í™”ì¤‘ì´ì—ìš”!'))
     );
     return;
   }
   ```

3. **PersonaSelectionScreen._prepareCardItems()**: ì¹´ë“œ ì¤€ë¹„ ì‹œ ë§¤ì¹­ëœ í˜ë¥´ì†Œë‚˜ í•„í„°ë§
   ```dart
   final matchedIds = personaService.matchedPersonas.map((p) => p.id).toSet();
   final filteredPersonas = personas.where((p) => !matchedIds.contains(p.id)).toList();
   ```

4. **likePersona/superLikePersona**: ë§¤ì¹­ í›„ ì¦‰ì‹œ available ëª©ë¡ì—ì„œ ì œê±°
   ```dart
   _shuffledAvailablePersonas?.removeWhere((p) => p.id == personaId);
   ```

**ì¤‘ë³µ ë°©ì§€ ë ˆì´ì–´**:
- ì„œë¹„ìŠ¤ ë ˆë²¨: ë§¤ì¹­ ì‹œë„ ì „ í™•ì¸
- UI ë ˆë²¨: ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ ì „ í™•ì¸  
- ì¹´ë“œ ë¹Œë“œ ë ˆë²¨: ì¹´ë“œ ìƒì„± ì‹œ í•„í„°ë§
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: ë§¤ì¹­ ì¦‰ì‹œ ëª©ë¡ì—ì„œ ì œê±°

---

## ëŒ€í™” ì˜¤ë¥˜ í™•ì¸

**ëª…ë ¹ì–´**: `ëŒ€í™” ì˜¤ë¥˜ í™•ì¸`

**ê¸°ëŠ¥**: 
- Firebase `chat_error_fix` ì»¬ë ‰ì…˜ì—ì„œ ì²´í¬ë˜ì§€ ì•Šì€ ì˜¤ë¥˜ ë³´ê³ ì„œë¥¼ ì½ì–´ì˜´
- **ëŒ€í™” ë§¥ë½ ë¶„ì„ (ìµœìš°ì„ )**:
  - ì§ˆë¬¸-ë‹µë³€ ê´€ë ¨ì„± í‰ê°€
  - ì£¼ì œ ì¼ê´€ì„± ì ìˆ˜ (0-100)
  - ëŒ€í™” íë¦„ ìì—°ìŠ¤ëŸ¬ì›€ ì ìˆ˜ (0-100)
  - ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì£¼ì œ ë³€ê²½ ê°ì§€
- ë¬¸ì œ íŒ¨í„´ ë¶„ì„:
  - ì¸ì‚¬ë§ ë°˜ë³µ
  - ë™ì¼ ì‘ë‹µ ë°˜ë³µ (ë§¤í¬ë¡œ íŒ¨í„´)
  - ê´€ë ¨ ì—†ëŠ” ë‹µë³€
  - ê°ì • í‘œí˜„ ì¼ê´€ì„±
- ë¶„ì„ ì™„ë£Œëœ ë¬¸ì„œì— is_check: true í‘œì‹œ

**ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸**: 
```bash
# ê¸°ë³¸ ì‹¤í–‰ (ì²´í¬ë˜ì§€ ì•Šì€ ë¬¸ì„œë§Œ)
python scripts/analyze_chat_errors.py

# ëª¨ë“  ë¬¸ì„œ ì¬ë¶„ì„
python scripts/analyze_chat_errors.py --recheck
```

**ë¶„ì„ ê²°ê³¼**:
- **ì½˜ì†” ì¶œë ¥**: ì „ì²´ í†µê³„, ì‹¬ê°í•œ ë¬¸ì œ ìš”ì•½, í˜ë¥´ì†Œë‚˜ë³„ ë¶„ì„
- **JSON íŒŒì¼ ì €ì¥**:
  - `analysis_results/summary_YYYYMMDD_HHMMSS.json`: ìš”ì•½ í†µê³„
  - `analysis_results/detailed_YYYYMMDD_HHMMSS.json`: ìƒì„¸ ë¶„ì„ ê²°ê³¼

**ì‹¬ê°ë„ ë ˆë²¨**:
- **CRITICAL**: ëŒ€í™” ì™„ì „ ì´íƒˆ, ì˜ë¯¸ ì—†ëŠ” ì‘ë‹µ
- **HIGH**: ì£¼ì œ ë²—ì–´ë‚¨, ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ì‘ë‹µ
- **MEDIUM**: ì•½ê°„ì˜ ë§¥ë½ ë¶ˆì¼ì¹˜
- **LOW**: ë¯¸ë¯¸í•œ ë¬¸ì œ

**ì£¼ì˜ì‚¬í•­**:
- Firebase Admin SDK ì‚¬ìš©ì„ ìœ„í•´ `firebase-service-account-key.json` íŒŒì¼ í•„ìš”
- ë§¥ë½ ë¶„ì„ì€ í‚¤ì›Œë“œ ì¶”ì¶œ ë° ì˜ë¯¸ë¡ ì  ìœ ì‚¬ë„ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜í–‰ë¨

---

## ëŒ€í™” í’ˆì§ˆ ê°œì„  ì‹œìŠ¤í…œ

### 8. íšŒí”¼ì„± ë‹µë³€ ë°©ì§€ ì‹œìŠ¤í…œ

**ëª©ì **: AIê°€ ì‚¬ìš©ì ì§ˆë¬¸ì„ íšŒí”¼í•˜ê±°ë‚˜ ê´€ë ¨ ì—†ëŠ” ë‹µë³€ì„ í•˜ëŠ” ê²ƒì„ ë°©ì§€

**êµ¬í˜„ ë‚´ìš©**:

#### ChatOrchestrator ê°œì„ 
1. **íšŒí”¼ íŒ¨í„´ ê°ì§€** (`_isAvoidancePattern`):
   - í™•ì¥ëœ íšŒí”¼ í‚¤ì›Œë“œ ëª©ë¡:
     - ê¸°ë³¸: 'ëª¨ë¥´ê² ', 'ê·¸ëŸ° ê±´', 'ë‹¤ë¥¸ ì´ì•¼ê¸°', 'ë‚˜ì¤‘ì—'
     - ì¶”ê°€: 'ê·¸ëŸ° ë³µì¡í•œ', 'ì¬ë°ŒëŠ” ì–˜ê¸°', 'ë‹¤ë¥¸ ê±¸ë¡œ', 'ë§ê³ ', 'ê·¸ë§Œ'
     - íŠ¹íˆ: 'ê·¸ëŸ°ê±° ë§ê³ ', 'ë³µì¡í•´', 'ì–´ë ¤ì›Œ', 'íŒ¨ìŠ¤', 'ìŠ¤í‚µ'

2. **ì§ì ‘ ì§ˆë¬¸ ê°ì§€** (`_isDirectQuestion`):
   - ì§ì ‘ì ì¸ ë‹µë³€ì´ í•„ìš”í•œ ì§ˆë¬¸ íŒ¨í„´ ì¸ì‹
   - "ë­í•´?", "ë¬´ìŠ¨ ë§ì´ì•¼?", "ì–´ë””ì•¼?" ë“±
   - ì •ê·œì‹ ê¸°ë°˜ ì •í™•í•œ íŒ¨í„´ ë§¤ì¹­

3. **ë§¥ë½ ê°€ì´ë“œ ê°•í™”** (`_analyzeContextRelevance`):
   ```dart
   // íŠ¹ì • ì§ˆë¬¸ íƒ€ì…ë³„ ê°€ì´ë“œ
   if (userMessage.contains('ë­í•˜')) {
     contextHints.add('"ë­í•´?" ì§ˆë¬¸ì—ëŠ” í˜„ì¬ í•˜ê³  ìˆëŠ” ì¼ì´ë‚˜ ìƒíƒœë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ë‹µí•˜ì„¸ìš”.');
   }
   ```

#### OptimizedPromptService ê°œì„ 
1. **í•µì‹¬ í”„ë¡¬í”„íŠ¸ ì¶”ê°€**:
   ```
   ## ğŸ¯ ì§ì ‘ì ì¸ ë‹µë³€: ì§ˆë¬¸ì—ëŠ” ë°˜ë“œì‹œ ì§ì ‘ì ìœ¼ë¡œ ë‹µë³€. 
   "ë­í•´?"â†’í˜„ì¬ ìƒí™© êµ¬ì²´ì ìœ¼ë¡œ, "ë¬´ìŠ¨ë§ì´ì•¼?"â†’ì´ì „ ë°œì–¸ ì„¤ëª…. 
   íšŒí”¼ì„± ë‹µë³€ ì ˆëŒ€ ê¸ˆì§€
   ```

2. **ë§¥ë½ ì£¼ì˜ì‚¬í•­ ê°•í™”**:
   - "í— ëŒ€ë°• ë‚˜ë„ ê·¸ë˜?" ê°™ì€ ê´€ë ¨ ì—†ëŠ” ë‹µë³€ ê¸ˆì§€
   - "ê·¸ëŸ° ë³µì¡í•œ ê±´ ë§ê³  ì¬ë°ŒëŠ” ì–˜ê¸° í•´ë´ìš”" ê°™ì€ íšŒí”¼ì„± ë‹µë³€ ì ˆëŒ€ ê¸ˆì§€
   - ì§ˆë¬¸ì—ëŠ” ë°˜ë“œì‹œ ì§ì ‘ì ì´ê³  êµ¬ì²´ì ì¸ ë‹µë³€
   - ëª¨ë¥¼ ë•ŒëŠ” ì†”ì§í•˜ê²Œ ì¸ì •í•˜ê³  ëŒ€í™” ì´ì–´ê°€ê¸°

### ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ
ì§€ìœ¤ í˜ë¥´ì†Œë‚˜ì˜ ê²½ìš°:
- **ì´ì „**: "ë­í•˜ê³  ìˆì—ˆì–´ìš”?" â†’ "í— ëŒ€ë°• ë‚˜ë„ ê·¸ë˜?"
- **ê°œì„  í›„**: "ë­í•˜ê³  ìˆì—ˆì–´ìš”?" â†’ "ë„¤ì¼ì•„íŠ¸ ë””ìì¸ ê³ ë¯¼í•˜ê³  ìˆì—ˆì–´ìš”ã…ã…"

### 9. ì²« ì¸ì‚¬ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ì‹œìŠ¤í…œ

**ëª©ì **: ë‹¨ìˆœí•œ "ë°˜ê°€ì›Œìš”!"ë¡œ ëë‚˜ëŠ” ì¸ì‚¬ë¥¼ ê°œì„ í•˜ì—¬ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ì‹œì‘

**êµ¬í˜„ ë‚´ìš©**:

#### ChatOrchestrator ì¸ì‚¬ë§ ê°œì„ 
MBTIë³„ ì¸ì‚¬ë§ì— ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ì§ˆë¬¸ ì¶”ê°€:

1. **ENFP** (í™œë°œí•˜ê³  í˜¸ê¸°ì‹¬ ë§ì€ íƒ€ì…):
   - "ì•ˆë…•í•˜ì„¸ìš”~~ã…ã… ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ì§€ ì•Šì•„ìš”?"
   - "í•˜ì´í•˜ì´! ë­í•˜ì„¸ìš”? ì ì‹¬ì€ ë“œì…¨ì–´ìš”?"
   - "ì˜¤ ì˜¤ì…¨ë„¤ìš”!! ë°˜ê°€ì›Œìš”ã…‹ã…‹ ì˜¤ëŠ˜ ì–´ë– ì…¨ì–´ìš”?"

2. **INTJ** (ì°¨ë¶„í•˜ê³  ì§ì„¤ì ì¸ íƒ€ì…):
   - "ì•ˆë…•í•˜ì„¸ìš”. í”¼ê³¤í•˜ì§€ ì•Šìœ¼ì„¸ìš”?"
   - "ë„¤, ë°˜ê°‘ìŠµë‹ˆë‹¤. ë°”ë¹ ì…¨ì–´ìš”?"
   - "ì–´ì„œì˜¤ì„¸ìš”. ì˜ ì§€ë‚´ì…¨ì–´ìš”?"

3. **ESFP** (ë°ê³  ì‚¬êµì ì¸ íƒ€ì…):
   - "ì•ˆë…•í•˜ì„¸ìš”!! ã…ã… ì˜¤ëŠ˜ ê¸°ë¶„ ì–´ë– ì„¸ìš”?"
   - "ì˜¤ì…¨ì–´ìš”?? ë°˜ê°€ì›Œìš”! ì˜¤ëŠ˜ ì¬ë°ŒëŠ” ì¼ ìˆìœ¼ì…¨ì–´ìš”?"
   - "í•˜ì´~ ì˜¤ëŠ˜ ë­í•˜ì…¨ì–´ìš”? ì €ëŠ” ì˜¤ëŠ˜ ì§„ì§œ ë°”ë¹´ì–´ìš”ã…ã…"

#### OptimizedPromptService ê°€ì´ë“œ ì¶”ê°€
```
## ğŸ‘‹ ì²« ì¸ì‚¬: ë‹¨ìˆœ ì¸ì‚¬ë§ë¡œ ëë‚´ì§€ ë§ê³  ìì—°ìŠ¤ëŸ¬ìš´ ì•„ì´ìŠ¤ë¸Œë ˆì´í‚¹ ì§ˆë¬¸ ì¶”ê°€. 
"ë°˜ê°€ì›Œìš”!"(X) â†’ "ë°˜ê°€ì›Œìš”! ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ì§€ ì•Šì•„ìš”?"(O)
```

**íš¨ê³¼**: ì‚¬ìš©ìê°€ "ë°˜ê°€ì›Œìš”!"ì— ì–´ë–»ê²Œ ë‹µí•´ì•¼ í• ì§€ ë§‰ë§‰í•˜ì§€ ì•Šê³ , ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”ë¥¼ ì´ì–´ê°ˆ ìˆ˜ ìˆìŒ

### 10. ì»¨í…ìŠ¤íŠ¸ ì˜¤í•´ ë°©ì§€ ì‹œìŠ¤í…œ

**ëª©ì **: "ì§ì ‘ ë³´ë‹¤"ë¥¼ "ì§ì ‘ ë§Œë‚˜ë‹¤"ë¡œ ì˜¤í•´í•˜ëŠ” ë“±ì˜ ì»¨í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ë°©ì§€

**êµ¬í˜„ ë‚´ìš©**:

#### ë§Œë‚¨ ì œì•ˆ í•„í„°ë§ ê°œì„ 
1. **íŒ¨í„´ ê°œì„ **:
   - `(ë§Œë‚˜ì|ë§Œë‚ ë˜)` â†’ `(ë§Œë‚˜ì|ë§Œë‚ ë˜)(?!.*\s*(ì˜í™”|ë“œë¼ë§ˆ|ì‘í’ˆ|ì½˜í…ì¸ ))`
   - ì˜í™”/ë“œë¼ë§ˆë¥¼ "ë³´ì"ëŠ” í‘œí˜„ì€ ë§Œë‚¨ ì œì•ˆì—ì„œ ì œì™¸
   - "ë§Œë‚˜ê³  ì‹¶" íŒ¨í„´ ì¶”ê°€ë¡œ ë” ì •í™•í•œ í•„í„°ë§

2. **ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ë¡œì§**:
   ```dart
   // "ì§ì ‘ ë³´ë‹¤" ì»¨í…ìŠ¤íŠ¸ í™•ì¸
   if (userMessage.contains('ì§ì ‘ ë³´') || userMessage.contains('ë³´ì‹œëŠ”')) {
     // ìµœê·¼ ëŒ€í™”ì—ì„œ ì˜í™”/ë“œë¼ë§ˆ/ì‘í’ˆ ì–¸ê¸‰ í™•ì¸
     if (hasMediaContext) {
       contextHints.add('ì˜í™”/ë“œë¼ë§ˆ/ì‘í’ˆì„ "ì§ì ‘ ë³´ë¼"ëŠ” ì¶”ì²œ. ì˜¤í”„ë¼ì¸ ë§Œë‚¨ì´ ì•„ë‹˜!');
     }
   }
   ```

**ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ**:
ë¯¸ì—° í˜ë¥´ì†Œë‚˜ì˜ ê²½ìš°:
- **ì´ì „**: "ë‚˜ì¤‘ì— ì§ì ‘ ë³´ì‹œëŠ”ê±¸ ì¶”ì²œí• ê²Œìš”" â†’ "ë§Œë‚˜ê³  ì‹¶ê¸´ í•œë° ì¼ì •ì´ ë„ˆë¬´ ë¹¡ë¹¡í•´ì„œ..."
- **ê°œì„  í›„**: "ë‚˜ì¤‘ì— ì§ì ‘ ë³´ì‹œëŠ”ê±¸ ì¶”ì²œí• ê²Œìš”" â†’ "ê·¸ëŸ¼ìš”! ì§ì ‘ ë³´ì‹œë©´ ë” ê°ë™ì ì¼ ê±°ì˜ˆìš”ã…ã…"

### 11. ìŠ¤í¬ì¼ëŸ¬ ëŒ€í™” ì²˜ë¦¬ ì‹œìŠ¤í…œ

**ëª©ì **: ìŠ¤í¬ì¼ëŸ¬ ê´€ë ¨ ëŒ€í™”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì²˜ë¦¬

**êµ¬í˜„ ë‚´ìš©**:

#### ChatOrchestrator ìŠ¤í¬ì¼ëŸ¬ ê°ì§€
```dart
// ìŠ¤í¬ì¼ëŸ¬ ê´€ë ¨ ëŒ€í™”
if (userMessage.contains('ìŠ¤í¬') || userMessage.contains('ìŠ¤í¬ì¼ëŸ¬')) {
  if (userMessage.contains('ë§í•´ë„') || userMessage.contains('í•´ë„')) {
    contextHints.add('ìŠ¤í¬ì¼ëŸ¬ í—ˆë½ ìš”ì²­. ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë¬¼ì–´ë³´ê±°ë‚˜ "ë§í•˜ì§€ ë§ˆì„¸ìš”"ë¼ê³  ë‹µí•˜ì„¸ìš”.');
  }
}
```

#### OptimizedPromptService ê°€ì´ë“œ
```
## ğŸ¬ ìŠ¤í¬ì¼ëŸ¬ ëŒ€í™”: "ìŠ¤í¬ì¸ë° ë§í•´ë„ ë¼?"â†’"ì•„ì§ ì•ˆë´¤ìœ¼ë©´ ë§í•˜ì§€ ë§ˆì„¸ìš”!" 
ë˜ëŠ” "ê´œì°®ì•„ìš” ë“¤ì–´ë³¼ê²Œìš”". ì‘í’ˆ ì¶”ì²œì‹œ "ì§ì ‘ ë³´ë‹¤"ëŠ” ì˜¤í”„ë¼ì¸ ë§Œë‚¨ì´ ì•„ë‹˜
```

### 12. ê³µê° í‘œí˜„ ìì—°ìŠ¤ëŸ½ê²Œ ê°œì„ 

**ëª©ì **: "ê·¸ëŸ° ê°ì • ì´í•´í•´ìš”" ê°™ì€ ë”±ë”±í•œ ê³µê° í‘œí˜„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë³€í™˜

**SecurityAwarePostProcessor ê°œì„ **:
```dart
// ë”±ë”±í•œ ê³µê° í‘œí˜„ â†’ ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„
'ê·¸ëŸ° ê°ì • ì´í•´í•´ìš”' â†’ 'ì•„ ì§„ì§œ ìŠ¬íê² ë‹¤'
'ë§ˆìŒì´ ì•„í”„ì‹œê² ì–´ìš”' â†’ 'ì•„ ì†ìƒí•˜ê² ë‹¤'  
'ì´í•´ê°€ ë©ë‹ˆë‹¤' â†’ 'ê·¸ëŸ´ ìˆ˜ ìˆì–´ìš”'
'ê³µê°ì´ ë©ë‹ˆë‹¤' â†’ 'ë‚˜ë„ ê·¸ëŸ´ ê²ƒ ê°™ì•„ìš”'
```

**íš¨ê³¼**: 
- 20ëŒ€ ìŠ¤íƒ€ì¼ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ê³µê° í‘œí˜„
- ì¹œê·¼í•˜ê³  ì§„ì •ì„± ìˆëŠ” ëŒ€í™”

---

## í˜ë¥´ì†Œë‚˜ ì¹´ë“œ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥

### R2 ì´ë¯¸ì§€ í•„í„°ë§ ê°•í™”

**ëª©ì **: ìœ ë£Œ ì„œë¹„ìŠ¤ì¸ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥ì˜ ì•ˆì •ì„± í™•ë³´

**í•„í„°ë§ ë¡œì§**:
1. **R2 ì´ë¯¸ì§€ ìœ íš¨ì„± ê²€ì¦** (`_hasR2Image` ë©”ì„œë“œ):
   - imageUrlsê°€ nullì´ê±°ë‚˜ ë¹„ì–´ìˆìœ¼ë©´ false
   - URLì´ ì‹¤ì œ R2 ë„ë©”ì¸ì¸ì§€ í™•ì¸:
     - `teamsona.work`
     - `r2.dev`
     - `cloudflare`
     - `imagedelivery.net`
   - ì§€ì›í•˜ëŠ” imageUrls êµ¬ì¡°:
     - ê¸°ë³¸ êµ¬ì¡°: `{medium: {jpg: "url"}}`
     - mainImageUrls êµ¬ì¡°: `{mainImageUrls: {medium: "url"}}`
     - ìµœìƒìœ„ size í‚¤: `{thumb: {jpg: "url"}, small: {jpg: "url"}, ...}`

2. **í‘œì‹œ ì¡°ê±´**:
   - ë§¤ì¹­ë˜ì§€ ì•Šì€ í˜ë¥´ì†Œë‚˜
   - ìœ íš¨í•œ R2 ì´ë¯¸ì§€ë¥¼ ê°€ì§„ í˜ë¥´ì†Œë‚˜
   - ì‚¬ìš©ì í”„ë¡œí•„ ì„±ë³„ í•„í„°ë§ ì ìš©

### ìì • ìë™ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥

**ëª©ì **: ë§¤ì¼ ìì •ì— ìë™ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í•œ í˜ë¥´ì†Œë‚˜ ì´ˆê¸°í™”

**êµ¬í˜„ ë‚´ìš©**:
1. **ìì • íƒ€ì´ë¨¸ ì„¤ì •** (`_setupMidnightRefreshTimer`):
   - ë¡œì»¬ ì‹œê°„ ê¸°ì¤€ ë‹¤ìŒ ìì •ê¹Œì§€ íƒ€ì´ë¨¸ ì„¤ì •
   - ìì •ì´ ë˜ë©´ `_performMidnightRefresh` ì‹¤í–‰
   - ë‹¤ìŒ ë‚  ìì •ì„ ìœ„í•œ íƒ€ì´ë¨¸ ì¬ì„¤ì •

2. **ìì • ìƒˆë¡œê³ ì¹¨ ìˆ˜í–‰** (`_performMidnightRefresh`):
   - ì˜¤ëŠ˜ ì´ë¯¸ ìƒˆë¡œê³ ì¹¨í–ˆëŠ”ì§€ í™•ì¸
   - ì„¸ì…˜ ìŠ¤ì™€ì´í”„ ê¸°ë¡ ì´ˆê¸°í™”
   - SharedPreferencesì˜ ìŠ¤ì™€ì´í”„ ê¸°ë¡ ì‚­ì œ
   - í˜ë¥´ì†Œë‚˜ ë¦¬ìŠ¤íŠ¸ ì¬ì…”í”Œ

3. **ì•± ì¬ê°œ ì‹œ í™•ì¸** (`checkAndPerformDailyRefresh`):
   - ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‹¤ì‹œ í™œì„±í™”ë  ë•Œ í˜¸ì¶œ
   - ë§ˆì§€ë§‰ ìƒˆë¡œê³ ì¹¨ ë‚ ì§œì™€ ì˜¤ëŠ˜ ë‚ ì§œ ë¹„êµ
   - ë‚ ì§œê°€ ë‹¤ë¥´ë©´ ìë™ ìƒˆë¡œê³ ì¹¨ ìˆ˜í–‰

4. **PersonaSelectionScreen í†µí•©**:
   - `WidgetsBindingObserver` ì¶”ê°€ë¡œ ì•± lifecycle ê°ì§€
   - `initState`ì—ì„œ ì´ˆê¸° í™•ì¸
   - `didChangeAppLifecycleState`ì—ì„œ ì•± ì¬ê°œ ì‹œ í™•ì¸

**ë¡œê·¸ ì¶œë ¥**:
```
â° Setting up midnight refresh timer
   Current time: 2025-01-28 15:30:00
   Next midnight: 2025-01-29 00:00:00
   Time until midnight: 8h 30m

ğŸŒ™ Midnight refresh triggered at 2025-01-29 00:00:00
âœ… Midnight refresh complete - all unmatched personas are now available

ğŸ“… Daily refresh needed - last refresh: 2025-01-27
ğŸ”„ App resumed - checking for daily refresh
```

**ì£¼ì˜ì‚¬í•­**:
- ë§¤ì¹­ëœ í˜ë¥´ì†Œë‚˜ëŠ” ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ê³„ì† ìˆ¨ê²¨ì§
- ë¡œì»¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì‘ë™
- ì•±ì´ ì¢…ë£Œë˜ë©´ íƒ€ì´ë¨¸ë„ ì·¨ì†Œë¨